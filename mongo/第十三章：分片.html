<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"/><meta name="author" content="lcx3114@163.com"/><meta name="created" content="2016-01-18 12:24:08 +0000"/><meta name="updated" content="2016-01-18 13:18:37 +0000"/><title>第十三章：分片</title></head><body><div><b>单机建立集群</b></div><div>mongo --nodb</div><div>cluster = new ShardingTest({"shards" : 3, "chunksize" : 1}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 创建一个包括3个分片的集群 </div><div>db = (new Mongo("localhost:30999")).getDB("test") &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;连接到集群的路由（mongos） </div><div>sh.status() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看集群状态 </div><div>sh.enableSharding("test") &nbsp;&nbsp;&nbsp;&nbsp; 数据库启用分片，不会主动启动分片 </div><div>db.users.ensureIndex({"username" : 1}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 要进行分片的键先要建立索引 </div><div>sh.shardCollection("test.users", {"username" : 1}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;对集合进行分片，不设置不会主动分片 </div><div>cluster.stop() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关闭集群 </div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>