<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"/><meta name="author" content="lcx3114@163.com"/><meta name="created" content="2016-01-19 12:49:06 +0000"/><meta name="updated" content="2016-01-20 12:21:56 +0000"/><title>第十六章：分片管理</title></head><body><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><b>检查集群状态</b></div><div>sh.status() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查看集群信息，信息来自config数据库，连接mongos查看 </div><div>config.shards &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;分片信息 </div><div>config.datebases &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 集群中的数据库信息 </div><div>config.collections &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;分片集合信息 </div><div>config.chunks &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;分片集合块信息 </div><div>config.changelog &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 记录集群的操作 </div><div>config.tags &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;分片标签信息 </div><div>config.settings &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;均衡器信息 </div><div><br/></div><div><br/></div><div><b>查看网络连接</b></div><div>db.adminCommand({"connPoolStats" : 1}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看mongos和mongod之间的连接信息 </div><div>mongos的命令行配置中使用maxConns限制连接数</div><div><br/></div><div><br/></div><div><b>服务器管理</b></div><div><br/></div><div><br/></div><div><b>数据均衡</b></div><div>sh.setBalancerState(false) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;关闭均衡器 </div><div>db.locks.find({"_id" : "balancer"})["state"] &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看均衡器状态 </div><div>db.settings.update({"_id" : "balancer"}, {"$set" : {"activeWindow" : {"start" : "13:00", "stop" : "16:00"}}}, true) &nbsp;&nbsp;&nbsp;&nbsp;均衡器只在13点到16点有效 </div><div>db.settings.save({"_id" : "chunksize", "value" : 32}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;修改块大小为32MB，不可拆分超过最大限制不可移动 </div><div>sh.moveChunk("test.users', {"user_id" : NumberLong("12323432")}, "spock") &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;手动迁移块 </div><div>sh.splitAt("test.users", {"user_id" : NumberLong("12323432")}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;手动拆分块 </div><div>db.adminCommand({"flushRouterConfig" : 1}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 刷新缓存配置 </div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div></body></html>