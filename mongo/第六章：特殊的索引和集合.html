<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"/><meta name="created" content="2016-01-13 08:39:52 +0000"/><meta name="source-url" content="http://blog.csdn.net/sd0902/article/details/16118831"/><meta name="updated" content="2016-01-14 02:14:15 +0000"/><title>第六章：特殊的索引和集合</title></head><body style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><b>固定集合</b></div><div>db.createCollection("my_collection", {"capped" : true, "size" : 10000， "max" : 100}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不同于普通集合，固定集合必须显示创建（例子为10000字节或100条文档）；集合大小创建后就不能改变；集合满了旧文档会被删除；固定集合不能分片 </div><div>db.runCommand({"convertToCapped" : "test", "size" : 100000}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将普通集合转换为固定集合；固定集合不能转为普通集合 </div><div><br/></div><div>db.my_collection.find().sort({"$natural" : 1}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 取得固定集合自然顺序（插入顺序） </div><div><br/></div><div>固定集合可使用循环游标（类似tail -f）,持续取得新插入的文档，10分钟没有新的自动关闭</div><div><br/></div><div><br/></div><div><b>TTL索引</b></div><div>db.users.ensureIndex({"lastUpdate"&nbsp;&nbsp;:&nbsp;&nbsp;1}, {"expireAfterSecs" : 60*60*24}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;TTL索引（具有生命周期的索引，例子超时时间为24小时）；不能是复合索引；每1分钟执行一次清理 </div><div><br/></div><div><br/></div><div><b>全文本索引</b></div><div>目前在实验阶段默认不启用，启动时指定--setParameter textSearchEnabled=true或运行时执行db.adminCommand({"serParameter" : 1, "textSearchEnabled" : true})</div><div><br/></div><div>db.blog.ensureIndex({"title"&nbsp;&nbsp;:&nbsp;&nbsp;"text"}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 创建全文本索引，创建占用系统资源高 </div><div>db.runCommand({"text" : "blog", "search" : "ask hn"}) &nbsp;&nbsp;&nbsp;&nbsp; 使用全文本索引；查询不区分大小写；能查询到部分匹配文档；只能对字符串索引，其它类型被忽略；一个集合只能有一个全文本索引，一个全文本索引可以保护多个字段，多个字段混合在一起同等对待，可指定权重，权重不能改变 </div><div>db.blog.ensureIndex({"$**"&nbsp;&nbsp;:&nbsp;&nbsp;"text"})&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;所有字段上创建全文本索引，$**可以设置权重 </div><div><br/></div><div>db.runCommand({"text" : "blog", "search" : "\"ask hn\""}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;精确匹配字符串 </div><div>db.runCommand({"text" : "blog", "search" : "\"ask hn\" ipod"}) &nbsp;&nbsp;&nbsp;&nbsp; 部分精确匹配 </div><div>db.runCommand({"text" : "blog", "search" : "-st vc"}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;不包含-后的st字符串 </div><div><br/></div><div>db.blog.ensureIndex({"title"&nbsp;&nbsp;:&nbsp;&nbsp;"text"}, {"default_language", "french"}) &nbsp;&nbsp;&nbsp;&nbsp; 指定语言，不同语言分词方式不一样 </div><div><br/></div><div><br/></div><div><b>地理空间索引</b></div><div>db.world.ensureIndex({"loc"&nbsp;&nbsp;:&nbsp;&nbsp;"2dsphere"}) &nbsp;&nbsp;&nbsp;&nbsp; 2dsphere索引，用于地球表面类型的地图；使用[1,40]经纬度表示点线多边形 </div><div>$geoIntersects &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查询相交地理位置 </div><div>$within &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查询完全包含的位置 </div><div>$near &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查询临近位置 </div><div><br/></div><div>db.world.ensureIndex({"tile"&nbsp;&nbsp;:&nbsp;&nbsp;"2d"}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 2d索引,用于扁平表面（游戏地图，时间连续的数据） </div><div><br/></div><div><br/></div><div><b>使用GridFS存储文件</b></div><div>不能修改，只能先删除再重新保存</div><div>使用mongofiles工具上传、下载、查看、搜索、删除文件</div><div><br/></div><div>mongofiles put foo.txt &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;上传文件 </div><div>mongofiles list &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看文件列表 </div><div>mongofiles get foo.txt &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;下载文件 </div><div>mongofiles search foo.txt &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查询文件 </div><div>mongofiles delete&nbsp;&nbsp;foo.txt &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 删除文件 </div><div><br/></div><div>db.fs.files.find() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查看文件信息（连接test下） </div><div>lehgth &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 文件字节数 </div><div>chunkSize &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;组成文件每个块大小，默认256k </div><div>uploadDate &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 上传时间 </div><div>md5 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;校验值 </div><div><br/></div><div>db.fs.chunks.find() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查看文件块信息 </div><div>files_id &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 文件信息id </div><div>n &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;块在文件中的相对位置 </div><div>data &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 块包含的二进制数据 </div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div></body></html>