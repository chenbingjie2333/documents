<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"/><meta name="author" content="lcx3114@163.com"/><meta name="created" content="2016-01-17 13:06:52 +0000"/><meta name="updated" content="2016-01-18 12:22:31 +0000"/><title>第十二章：管理</title></head><body><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><b>以单机模式启动成员</b></div><div>db.severCmdLineOpts() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看服务器参数 </div><div>副本启动时不使用replSet选项，修改端口号，实现单机启动不再是副本集成员</div><div><br/></div><div><br/></div><div><b>副本集配置</b></div><div>副本及配置保存在local.system.replSet集合中</div><div>副本集最多12个成员，最多7个成员有投票权限（其它成员"votes":0）</div><div><br/></div><div>rs.reconfig(config, {"force" : true}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 强制在副本上配置，默认只能在主节点上配置 </div><div><br/></div><div><br/></div><div><b>修改成员状态</b></div><div>rs.stepDown(600) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 将主节点降为备份节点(时间限制为10分钟，10分钟内没有选举出主节点，成员再次升级为主节点；可以不设置时间默认60秒） </div><div>rs.freeze(10000) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 强制成员为备份节点（阻止选举；rs.freeze(0)恢复） </div><div>db.adminCommand({"replSetMaintenanceMode" : true}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;副本进入维护模式，false取消维护模式 </div><div><br/></div><div><br/></div><div><b>监控复制</b></div><div>rs.status() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 查看每个成员状态 </div><div>secondary.adminCommand({"replSetSyncFrom" : "server-0:27017"}) &nbsp;&nbsp;&nbsp;&nbsp;修改复制源（要注意避免出现复制循环） </div><div>config.settings.allowChaining = false &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 强制从主节点复制 </div><div>在主节点执行db.printReplicationInfo() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;查看oplog信息 </div><div>备份节点上执行db.printSlaveReplicationInfo() &nbsp;&nbsp;&nbsp;&nbsp; 当前节点落后与主节点最后操作的时间 </div><div><br/></div><div>修改oplog长度：主节点退位-&gt;关闭-&gt;单机模式启动-&gt;oplog最后一条保存到其它集合中-&gt;删除oplog-&gt;创建新oplog指定长度-&gt;回写保存在其它集合中的最后一条oplog-&gt;重新启动</div><div><br/></div><div>从延迟备份节点中恢复：关闭所有其他成员-&gt;删除其他成员数据-&gt;启动所有成员</div><div><br/></div><div>local.slaves集合保存从当前程序进行数据同步的成员</div><div><br/></div><div><br/></div><div><b>主从模式</b></div><div>mongod --master</div><div>mongod --slave --source service-1:27017</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div></body></html>