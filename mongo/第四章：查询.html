<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"/><meta name="created" content="2016-01-11 09:18:47 +0000"/><meta name="updated" content="2016-11-29 09:22:28 +0000"/><title>第四章：查询</title></head><body><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div><b>find简介</b></div><div>db.users.find()                  查询全部文档</div><div>db.users.find({"name" : "a"})    条件查询，多个条件时是AND的关系，值必须是常量</div><div>db.users.find({}, {"name" : 1, "_id" : 0})      指定返回的字段，默认_id返回，[0]表示去掉字段</div><div><br/></div><div><br/></div><div><b>查询条件</b></div><div>db.users.find({"age" : {"$gte" : 18, "$lte" : 30}})           范围查询</div><div>$gte &gt;=    $gt &gt;    $lte &lt;=    $lt &lt;   （数组字段有问题，[10,40]也会被检出，可以使用$elemMatch不匹配数组字段）</div><div>db.users.find({"name" : {"$ne" : "a"}})                       不等于</div><div>db.users.find({"name" : {"$in" : ["a","b"]}})                 in</div><div>db.users.find({"name" : {"$nin" : ["a","b"]}})                no in</div><div>db.users.find({"$or" : [{"name" : "a"}, {"name" : "b"}]})     or</div><div>{"id_num" : {"$mod" : [5, 1]}}                                除5余数为1的字段</div><div>{"id_num" : {"$not" : {"$mod" : [5, 1]}}}                     除5余数不为1的字段</div><div>{"$and" : [{"x" : {"$lt" : 1}}, {"x" : 4}]}                   and</div><div><br/></div><div><br/></div><div><b>特定类型的查询</b></div><div>{"z" : null}如果z字段不存在则返回全部文档，需使用{"z" : {"in" : [null], "$exists" : true}}</div><div>{"name" : /joe/i}                              正则表达式查询</div><div>{"name" : {"$all" : ["a", "b"]}}               查询name数组，匹配多个值，单个使用{"name" : "a"}即可</div><div>{"name.0" : "a"}                               查询数组指定位置字段</div><div>{"name" : {"$size" : 3}}                       查询指定长度的数组，不能使用$gt等范围查询</div><div>db.users.find({}, {"name" : {"$slice" : 10}})  返回数组的前十条，负数则为后十条，[23,10]返回24~33的元素，其它字段默认返回</div><div>db.users.find({"comments.name" : "bob"}, {"comments.$" : 1})   返回name是bob的数组文档，只返回第一个</div><div>{"comments" : {"$elemMatch" : {"author" : "joe", "score" : {"$gte" : 5}}}}         对内嵌文档进行查询</div><div><br/></div><div><br/></div><div><b>$where查询</b></div><div>{"$where" : function() {</div><div>    for (var current in this) {</div><div>        for (var other in this) {</div><div>            if (current != other &amp;&amp; this[current] == this[other]) {return true;}</div><div>        }</div><div>    }</div><div>    return false;</div><div>}}</div><div>$where使用函数查询，速度比较慢</div><div>直接使用函数，由用户传递来的参数可能带来安全性问题，如传入删除数据库方法</div><div><br/></div><div><br/></div><div><b>游标</b></div><div>var cursor = db.collection.find()            变量保存的是游标，查询为懒查询</div><div>cursor.hasNext()    cursor.next()            使用游标</div><div>cursor.forEach(function(x) {})               使用游标</div><div><br/></div><div>db.c.find().limit(3)                         最多查询3条</div><div>db.c.find().skip(3)                          掠过前3条，效率较低，分页可采用每页最后一条记录作为查询条件查询下一页</div><div>db.c.find().sort({name : 1, age : -1})       1升序，-1降序</div><div>排序字段不同类型优先顺序：最小值、null、数字、字符串、对象\文档、数组、二进制数据、对象ID、布尔、日期、时间戳、正则、最大值</div><div><br/></div><div>db.c.find()._addSpecial("$maxscan", 20)       指定查询扫描文档上限</div><div>$min            查询开始条件，需要索引</div><div>$max            查询结束条件，需要索引</div><div>$showDiskLoc    查询结果显示磁盘位置</div><div><br/></div><div>db.c.find().snapshot()                        快照查询，防止处理查询结果并更新，文档移动时重新处理相同的文档，效率较慢</div><div><br/></div><div>游标默认10分钟内没使用完也会自动销毁</div><div><br/></div><div><br/></div><div><b>数据库命令</b></div><div>db.runCommand({"drop" : test})                删除集合，使用runCommand执行数据库命令</div><div>db.adminCommand({"shutdown" : 1})             adminCommand执行一个管理员命令</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></div></div><div><br/></div></body></html>