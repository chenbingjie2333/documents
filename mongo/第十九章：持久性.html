<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"/><meta name="author" content="lcx3114@163.com"/><meta name="created" content="2016-01-21 12:33:24 +0000"/><meta name="updated" content="2016-01-21 12:50:07 +0000"/><title>第十九章：持久性</title></head><body><div><b>日志系统的用途</b></div><div>日志保存写入操作内容，默认每60秒刷新一次磁盘，文件存放在/data/db/journal中</div><div>每100毫秒写入一次日志</div><div>db.adminCommand({"setParameter" : 1, "journalCommitInterval" : 10}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;修改写入日志间隔为10毫秒 </div><div><br/></div><div>mongod --dbpath /path/to/corrupt/data --repair &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 修复数据文件 </div><div>mongodump --repair &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 修复数据文件，更接近底层，速度较慢 </div><div>mongod.lock数据库正常退出时会清空，未正常退出不会清空，未清空会影响数据库启动，需进行数据文件修复</div><div><br/></div><div><br/></div><div><b>检验数据损坏</b></div><div>db.foo.validate() &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 检验集合是否损坏 </div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>