<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"/><meta name="author" content="lcx3114@163.com"/><meta name="created" content="2016-01-17 05:02:28 +0000"/><meta name="updated" content="2016-01-17 13:06:41 +0000"/><title>第十一章：从应用程序连接副本集</title></head><body><div><b>客户端至副本集的连接</b></div><div>"mongodb://server-1:27017,server-2:27017"</div><div><br/></div><div><br/></div><div><b>等待写入复制</b></div><div>db.runCommand({"getLastError" : 1, "w" : "majority", "wtimeout" : 1000}) &nbsp;&nbsp;&nbsp;&nbsp; 等待写入复制给多数；wtimeout设置超时时间1秒 </div><div>"w" : 2 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 等待写入复制给1个副本，即保存到2个副本 </div><div><br/></div><div><br/></div><div><b>自定义复制保证规则</b></div><div>config.members[0].tags = {"dc" : "us-east"} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 对成员分类 </div><div>config.settings = {} &nbsp;&nbsp;config.settings.getLastErrorModes = [{"eachDC" : {"dc" : 2}}] &nbsp;&nbsp; rs.reconfig(config) &nbsp;&nbsp;&nbsp;&nbsp;假设tags设置了两个分类 </div><div>db.runCommand({"getLastError" : 1, "w" : "eachDC", "wtimeout" : 1000}) &nbsp;&nbsp;&nbsp;&nbsp; 保证数据复制到每个分类下 </div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>