<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.10 (454269)"/><meta name="author" content="lcx3114@163.com"/><meta name="created" content="2016-01-16 15:21:17 +0000"/><meta name="updated" content="2016-01-17 04:49:48 +0000"/><title>第十章：副本集的组成</title></head><body><div><b>同步</b></div><div>使用local数据库中的oplog操作日志实现同步</div><div><br/></div><div><br/></div><div><b>心跳</b></div><div>每个成员每隔2秒发送一个心跳请求，用于检测每个成员状态</div><div><br/></div><div><br/></div><div><b>选举</b></div><div>使用多数原则选举主节点</div><div><br/></div><div><br/></div><div><b>回滚</b></div><div>主节点的操作没有复制到副本中就被断开，副本中产生新的主节点继续使用，主节点再次连接时就产生回滚</div><div>回滚信息保存在数据目录下rollback目录的.bson文件中</div><div><br/></div><div>mongorestore --db stage --collection stuff \</div><div>/data/db/rollback/important.stuff.2012-12-19T18-27-14.0.bson &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将回滚数据加载到一个临时集合 </div><div>staging.stuff.find().forEach(function(doc){prod.stuff.insert(doc);}) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;将临时集合加载到主集合中 </div><div><br/></div><div>如果回滚数量大于300MB或大于30分钟回滚就会失败，只能重新同步</div><div><br/></div><div><br/></div><div><br/></div><div><br/></div><div><br/></div></body></html>